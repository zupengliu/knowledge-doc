## 规则引擎能做什么？
1. 业务复杂多变，项目经常面临的问题
2. 规则引擎能帮我们做什么

### 业务复杂多变，项目经常面临的问题
1. 当业务规则变更时，对应的代码也得跟着更改，每次即使是小的变更都需要经历开发、测试、上线等过程，变更成本比较大
2. 长时间系统变得越来越复杂，难以维护
3. 系统僵化，新需求插入困难
4. 新需求上线周期比较长

### 规则引擎能帮我们做什么
  规则引擎是一种嵌入在应用程序中的组件，实现了**将业务决策从应用程序代码中分离出来**，并使用预定义的语义模块编写业务决策。接受数据输入，解释业务规则，并根据业务规则作出业务决策。
  规则引擎对业务抽象，可以大大提升效率

### 使用场景
相对于业务系统，规则引擎可以认为是一个独立于业务系统的模块，负责一些规则的计算等。

一般来说，规则引擎主要应用在下面的场景中：
- 风控模型配置，风控是规则引擎
- 实时推荐系统配置，如根据用户流量属性，进行规则计算，输出计算结果
- 简单的离线计算，各类数据量比较小的统计等
- 一切需要解耦复杂业务逻辑的应用系统

### 规则引擎的实现方式
一套规则引擎总体就是要做到以下的目标：
- 定义规则语言语义标准（我们采用的Groovy实现）
- 动态编辑规则条件,例如大于、小于、等于、如果、那么等等语义
- 动态编辑规则脚本
- 动态发布更新集群的能力
- 自动化执行
### 规则引擎的难点要求
- 优先级问题，先执行什么判断、后执行什么判断，先执行什么逻辑、后执行什么逻辑
- 规则冲突如何避免
- 如何设计一套足够支撑全业务场景的规则管理模型。
### 具体部分实现

业务规则我们认为可以抽象为以下几点

    - 名称:一种唯一的规则名称
    - code:每一条规则的唯一标识
    - 描述:对规则的简要描
    - 内容：规则脚本具体内容
    - 优先级:相对于其他规则的优先级
    - 状态：规则脚本 测试中、开发中、验证中、已上线、下线

规则判断条件抽象为：
  - 大于、小于、等于、如果、否则等等

技术实现抽象为：

    - 定义规则脚本属性
    - 提供在线配置规则判断流程
    - 实时在线测试规则脚本
    - 在线审核、上线
    - 分布式环境推送工作流

### 规则引擎如何执行
通过规则条件、规则脚本预初始化，实现全部内存加载，我们的流程如下：

?????

首先通过Zookeeper，发送通知，服务收到后，主动获取变更的规则

获取规则内容后，实例化规则对象

同时，使用规则code区分每一个规则

在集群中每一台服务器上的JVM内存中，缓存下来所有的规则对象，其中包含了Class文件（后文会说明，为何一定要缓存）

业务系统通过在管理平台，配置每一种业务在哪一种场景下，需要调用哪些规则，并且指定优先级

规则引擎，通过输入的code，在本地缓存中，找到在管理平台中，定义的code对应的规则执行流程

在流程中，依优先级，在本地缓存中获取每一条规则对象，取出其中的Class文件，获取实例对象Script

根据使用方输入参数，使用Binding对象，进行参数绑定，并使用setBinding(Binding binding)方法，进行绑定。

最后 call method run，进行规则执行。

### 部分代码实例如下：

1、规则提前初始化实现

2、规则缓存实现

3、规则执行接口

4、规则执行实现
